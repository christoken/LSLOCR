<!DOCTYPE html> 
<html>
<head>
	<title>LSL OCR Scanner</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">	
		 <meta charset="UTF-8">
	 <link rel="stylesheet" href="css/datepicker.css">	
	 <link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css" />
	 <link rel="stylesheet" href="css/jquery-ui.css">
	<!-- link to jQuery and jQuery Mobile JavaScript libraries: -->
	<script src="js/jquery-1.10.1.min.js"></script>
	<script src="js/jquery.mobile-1.3.1.min.js"></script>	 	 
	 <script src="js/jquery-ui.js"> </script>	 	 
	 <script src="js/datepicker.js"></script>
	<script type="text/javascript" src="cordova.js"></script> 	
	 <script src="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.js"></script>
    <link type="text/css" rel="stylesheet" href="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.css"/>

	<!--<script 	  src="http://maps.google.com/maps/api/js?key=AIzaSyBlRL7HLQhCd-rz7DdB5aKTe63kFk8jBPM&ver&sensor=false">
	
	</script>	
	
	AIzaSyCNOiO5P22wUCCOe7MIquPFPps4b6N3LAI // old working key
	AIzaSyAPxbNErnG4KdzBZ3Xj_8810LzCJpFDQ0A //
	//AIzaSyBlRL7HLQhCd-rz7DdB5aKTe63kFk8jBPM //current key
	-->
 <script>
	var serverURL="http://localhost/meetUP/server/"; // The server address of the PHP files
	var baseURL="http://localhost/meetUP/";
	var serverURL="http://3modernsystems.com/meetUP/server/"; // The server address of the PHP files
	var baseURL="http://3modernsystems.com/meetUP/";
	L.mapquest.key = '1GSDb5IzqcbV0rHMAlJR99A8TsGN7Q6H';
	
	var fingerOrPin=0; 
	var acAddress="";
	var simSerial1="";
	var simSerial2="";
	var saveORlog=3;//0 is log 1 is save new points
	var globalusn="";
	var globalNames="";
	var globalTelNo="";
	//var logtype=2;
	//0 is fingerprint, 1 is pin.
 </script>
</head>
<!-- <body  onpageshow="checkonPageshow()"   style="display: mfloginPage;"> -->

<body  onpageshow="checkonPageshow()"   style="display: manualcapture;">
	<div id="dialog" title="OCR">
		<p id="alertclass1">LSL OCR</p>
	</div>
<!-- the div below is a page - the home page -->
<div data-role="page" id="mfloginPage" >
   <script>
   $(document).ready(function(){
   
		$("#btnlogin").click(function(){
		document.getElementById("loginerror").innerHTML="";
		var username= $("#loginId").val();
		var password=$("#loginPassword").val();	
		
		if(username=='' && password==''){
		var response="Please fill out the required fields";
		displayAlert(response);
		//alert("Please fill out the form");
		}
		else if(username=='' && password!==''  ){alert('Username field is required')}
		else if(password=='' && username!=='' ){alert('Password field is required')}
		
		else{	
		var url=serverURL + "loginmobile.php";
			$.ajax(
			{
				// Post select to url.
				"method" : 'post',
				"url" : url,
				async: true,
				//crossDomain: true,
				dataType : 'json', // expected returned data format.
				
				data : {
						'username':username,
						'password':password
						
			   },
				success : function(data, textStatus, jqXHR){               
				// alert(data);//"response" receives - whatever written in echo of above PHP script.
				var size= data.length;
				//alert(size);
			if(size>2)  {			
			var pc = data.split('_');						
			var username=pc[0]; 
			var names=pc[1];
			var telNo=pc[2];
			var pwdChange=pc[3];			
			
			if(pc[3]=='0'){
			//not yet changed your password and hence directed to change password			
			window.location.replace("index.html#changePassword");
			//window.location.href = baseURL +"index.html#changepassword";
			//location.reload();
			}else{
				storeSession(username,names,telNo,telNo);//call function to say if we are logged in						
			   //window.location.href = baseURL +"index.html#homePage"; //direct to the homepage if login is successfull 
				//window.location.replace(baseURL +"index.html#payrollChanges") ;
				window.location.replace("index.html#manualcapture") ;
			}
			}
			else {
			//document.getElementById("dialog").innerHTML="Loging error: Your login failed. Ensure that your email is verified and that your password, username or organization is correct and that your trial period has not expired.";
				//displayAlert();
				//alert("Login Failure: Login page");
		var response="Loging error: Your login failed. Ensure that your email is verified, your password, username or organization is correct and that your trial period has not expired.";
		displayAlert(response);				
		document.getElementById("loginerror").innerHTML="Loging error: Your login failed. Ensure that your email is verified, your password, username or organization is correct and that your trial period has not expired.";
				
			    }
				},
				error: function(jqXHR, textStatus, errorThrown){
					alert(errorThrown,textStatus );
			},
				complete : function(data){
					// do something, not critical.
			}
			});
		}
		
		});
			
		});
   </script>
         <div data-role="header" data-theme="d">
           <!-- <a data-iconpos="notext" href="#Registrationpage" data-role="button" data-icon="back"></a>-->
			 <a  data-role="button" data-icon="home" title="Home" href="#Registrationpage"> </a>
			
            <h1>LSL Login</h1>
         </div>
		 
         <div data-role="content" role="main">
            
			<div class="ui-block"><input onblur="checkLengthLogin(this,'loginerror','#btnlogin')" type="text" required="required" placeholder="Username" id="loginId" value="" maxlength="12"/></div>
            <div class="ui-block"><input onblur="checkLengthLogin(this,'loginerror','#btnlogin')" type="password" required="required" placeholder="Password" id="loginPassword" value="" maxlength="12"/></div>
              
		   <div ><a data-role="button"  data-icon="flat-settings" data-theme="e" id="btnlogin" >Log in</a></div>
			 <!-- <div class="ui-block"><a data-role="button" type="submit" required="required" data-icon="flat-settings" data-theme="d" id="btnlogin" >Login</a></div>--> 
            <div id="loginerror"> </div>
         </div>
         <div data-role="footer" data-theme="d">
               <h1>&copy;LSL</h1>
         </div>
      </div>
<div data-role="page" id="manualcapture">

	<!-- the div below is the home page's header -->
	<div data-role="header">
		<h1>Manual</h1>
		<div data-role="navbar">
	        <ul>
	            <li><a href="#manualcapture"  class="ui-btn-active ui-state-persist" data-icon="star">Manual</a></li>
				<li><a href="#ocrcapture" data-icon="star">OCR</a></li>
				<li><a href="#searchMember"  data-icon="star">Search</a></li>
						
	        </ul>
	    </div>
		<h4 id="sessionText"></h4>
	</div>
	<!-- the div below is the home page's main content -->
	<div data-role="content">
	<script>
	$(document).ready(function(){	
		var urlPF=serverURL +"selectpfIDNo.php";		
		$("#pfIDNo").blur(function() {
		var pfIDNo=$("#pfIDNo").val();
                $.ajax({
                    url: urlPF,
                    dataType: "json",
                    type:"POST",
					data : {
			pfIDNo:pfIDNo		
			},
        success: function (data) {                    
			var JSONString = JSON.stringify(data);		
			var obj=JSON.parse(JSONString);			
			var pf=	obj[0].pf_number;	
			var id=obj[0].id_number;
			var surname=obj[0].surname;
			var othernames=obj[0].othernames;
			var assignment_code=obj[0].assignment_code;
		$("#empNames").val (surname+" "+othernames);
		$("#assignment").val(assignment_code);				
                 },
            }); 
			});
		/*	
		$('#pfIDNo').autocomplete({ //beginning of animal breed autocomplete
            minLength: 4,
            source: function(request, response,term) {
			console.log("Pressed key");
                var param = request.term;
                $.ajax({
                    url: urlPF,
                    dataType: "json",
                    type:"POST",
                    success: function (data) {
                         array=($.map(data, function(item) {						 
                             return { 
                                 label: item.pf_number +" => " + item.surname,   //I am displaying both label and value                        
                                 surname: item.surname,
								 othernames:item.othernames,
								 value: item.pf_number,
								 assignment: item.assignment_code
                                 };								 
                             }));//END Success
							 response($.ui.autocomplete.filter(array, request.term));
							 //console.log("term is "+request.term);							 
                        },
                });//END AJAX
            },
            select: function(event, ui ) { // 
			$("#empNames").val (ui.item.surname+" "+ui.item.othernames);
			$("#assignment").val(ui.item.assignment);			
               //console.log("Name is "+ui.item.label);
			   //console.log("PF is "+ui.item.value);
			   //console.log("Ass is "+ui.item.assignment);
            } 
        });	*/
		
	var urlAss=serverURL +"selectAssignment.php";			
		$('#assignment').autocomplete({ //beginning of animal breed autocomplete
            minLength: 4,
            source: function(request, response,term) {
			console.log("Pressed key");
                var param = request.term;
                $.ajax({
                    url: urlAss,
                    dataType: "json",
                    type:"POST",
                    success: function (data) {
                         array=($.map(data, function(item) {						 
                             return { 
							 
                           label: item.assignment_code +" => " + item.assignment_name,                                 
						   value: item.assignment_code
								
                                 };								 
                             }));//END Success
							 response($.ui.autocomplete.filter(array, request.term));
							 //console.log("term is "+request.term);							 
                        },
                });//END AJAX
            },
            select: function(event, ui ) { // 
			
            } 
        });				
		
		$("#btnSavePaychanges").click(function(){
		 saveORlog=1;
		if($("#pfIDNo").val()!='' && $("#empNames").val()!='' && $("#assignment").val()!='' && $("#dateDeployedLeft").val()!='' &&
		$("#salaryMonth").val()!='' && $("#daysWorked").val()!='' && $("#changeType").val()!=''){
			//findPhone();
			var x;
			var y=$('#changeType option:selected').text();
			if($("#changeType").val()==1){
			x="Remove guard";
			}
			else {
			x="Add guard";
			}
			
			
			logSavePayAlert("Are you sure you want to "+y+" ?");
			//getLocation();
		}else {
			displayAlert("You need to enter the required details to proceed");
		return;
		}
	
		});
		
	});
		</script>
		<div id="payDetails">
		
	<div class="ui-grid-a ui-responsive">
	 <div class="ui-block-a" style="width:30%"><label><b>PF/ID No.:</b> </label> </div>
	<div class="ui-block-b" style="width:70%">  <input type="text" required="required" data-clear-btn="true" placeholder="PF/ID No:" id="pfIDNo"/></div>
	<div class="ui-block-a" style="width:30%" ><label> <b>Name:</b> </label> </div>
	<div class="ui-block-b" style="width:70%" >   <input type="text" required="required" data-clear-btn="true" placeholder="Names:" id="empNames"/></div>
	<div class="ui-block-a" style="width:30%" ><label><b>Assignment:</b> </label> </div>
	<div class="ui-block-b" style="width:70%" >   <input type="text" required="required" data-clear-btn="true" placeholder="Assignment:" id="assignment"/></div>
	<div class="ui-block-a" style="width:30%" ><label><b>Date</b> </label> </div>
	<div class="ui-block-b" style="width:70%" ><input type="date" placeholder="Date Deployed/Left:" id="dateDeployedLeft" data-inline="true" data-toggle="datepicker"/></div>
	<!--
	<div class="ui-block-a" style="width:30%" ><label><b>Period:</b> </label> </div>
	<div class="ui-block-b" style="width:70%" ><input type="date" placeholder="Salary Month:" id="salaryMonth" data-inline="true" data-toggle="datepicker"/></div>
	-->
	<div class="ui-block-a" style="width:30%" ><label align="centre"><b>Days:</b> </label> </div>
	<div class="ui-block-b" style="width:70%" ><input type="number" placeholder="Days Worked" id="daysWorked"/></div>
	<div class="ui-block-a" style="width:30%" ><label><b>Change Type:</b> </label> </div>
	<div class="ui-block-b" style="width:70%" >	
		<select name="changeType" id="changeType">
			<option value="" >Select</option>
			<option value="0">Leave Reliever</option>
			<option value="0">Additional guards</option>
			<option value="0">Off Reliever</option>
			<option value="0">Replacement</option>
			<option value="0">New Employee</option>
			<option value="0">New Assignment</option>
			<option value="1">Old guard leaving</option>
			<option value="1">Terminated Assignment</option>  			
	  </select>
	  </div>
	</div>		
		
	</div>

	<div class="ui-grid-a ui-responsive">
	
			<div class="ui-block-a"> <a data-role="button" data-icon="flat-settings" data-theme="d" id="btnSavePaychanges" >Submit.</a></div>
			
			<div class="ui-block-b"> <a onclick="exitAlert('Are you sure you want exit App?');" data-role="button" data-icon="flat-settings" data-theme="e" id="btnExitPC" >Exit App</a></div>
			
	</div>	
	</div>

	<!-- the div below is the home page's footer -->
	<div data-role="footer">
		<h4>Location Log  &copy;Lavington Security Limited</h4>		
		<a href="app-debug.3516483.102.apk" target="_blank">Download APP</a>
	
	</div>
</div>

<!-- the div below is a page - the about page -->
<div data-role="page" id="ocrcapture">
	<div data-role="header">
		<h1>OCR</h1>
		<div data-role="navbar">
	        <ul>
				<li><a href="#manualcapture"  data-icon="star">Manual</a></li>
				<li><a href="#ocrcapture" class="ui-btn-active ui-state-persist" data-icon="star">OCR</a></li>				
	            <li><a href="#searchMember"  data-icon="star">Search</a></li>	
												
				</ul>
	    </div>
	</div>
	<div data-role="content">
			<script>
		$(document).ready(function(){
		
		$("#btnCapture").click(function(){
			//saveORlog=0;
			//logtype=0;
			//if($("#loc_telNo").val()!=''){
			//check if the person has logged upto five in a day. 
	createStorage();
	if(checkLogingLimit()){	
	//findPhone();
	//logAlert("Are you sure you want to log?");
	   //getLocation();
	   getCameraImage();
	  // increaseLogCount();   
	}
	else{
	alert("You seem to have reached your limit of loging");
	
	}

			//findPhone();
			//logAlert("Are you sure you want to log?");
			//getLocation();
		/*}else {
			displayAlert("You need to enter your Tel # to proceed");
		return;
		}*/
	
		});
	});
		</script>
	<div id="captureDetails">
	<div class="ui-block">
		<select name="captureType" id="captureType">
			<option value="0">New ID</option>
			<option value="1">Old ID</option>
			<option value="2">Passport</option>
			<option value="3">Drivers Licence</option>
			<option value="4">Vehicle</option>    
	  </select>
	</div>
		
		<p>Names: <span id="visitornames"></span></p>
		<p>ID No: <span id="id_number"></span></p>
      <label><b>Vehicle Reg. No.:</b> </label> 
	<input type="text" data-clear-btn="true" placeholder="Vehicle Reg. No." id="vehicle_reg"> </input>
	<label> <b>Occupants:</b> </label>
    <input type="text"  data-clear-btn="true" placeholder="Occupants:" id="occupants"></input>
		
	</div>

	
	
	<div class="ui-grid-a ui-responsive">
			<div class="ui-block-a"> <a data-role="button" data-icon="flat-settings" data-theme="d" id="btnCapture" >Capture</a></div>
			<div class="ui-block-b"> <a onclick="exitAlert('Are you sure you want exit App?');" data-role="button" data-icon="flat-settings" data-theme="b" id="btnexitLogCapture" >Exit App</a></div>
	</div>
	
	</div>
	<div data-role="footer" data-theme="e">
		<h4>Location Log  &copy;Lavington Security Limited</h4>
	</div>
</div>

<div data-role="page" id="searchMember">
	<div data-role="header">
		<h1>Search</h1>
		<div data-role="navbar">
	        <ul>
	            <li><a href="#manualcapture"  data-icon="star">Manual</a></li>
				  <li><a href="#ocrcapture"  data-icon="star">OCR</a></li>
				<li><a href="#searchMember" class="ui-btn-active ui-state-persist" data-icon="star">Search</a></li>				
	          				
				
	        </ul>
	    </div>
	</div>
	<div data-role="content">
		<p>Press the Log button to log current location</p>
		<script>
		$(document).ready(function(){		
		$("#btnSaveLocation").click(function(){
		 saveORlog=1;
		if($("#clientName").val()!='' || $("#locationName").val()!='' || $("#pointName").val()!=''){
			findPhone();
			logAlert("Are you sure you want to save this locations?");
			//getLocation();
		}else {
			displayAlert("You need to enter the required details to proceed");
		return;
		}
	
		});
	});
		</script>
	<div id="locationDetails">
	
		<div class="ui-block"><input type="text" required="required" data-clear-btn="true" placeholder="Client:" id="clientName"/></div>
		<div class="ui-block"><input type="text" required="required" data-clear-btn="true" placeholder="Location Name:" id="locationName"/></div>
		<div class="ui-block"><input type="text" required="required" data-clear-btn="true" placeholder="Point Name:" id="pointName"/></div>
		<p>Address: <span id="saveAddress"></span></p>
		<p>Latitude: <span id="latSave"></span></p>
		<p>Longitude: <span id="longSave"></span></p>
	</div>
	
	<div class="ui-grid-a ui-responsive">
			<div class="ui-block-a"> <a data-role="button" data-icon="flat-settings" data-theme="d" id="btnSaveLocation" >Save Loc.</a></div>
			<div class="ui-block-b"> <a onclick="exitAlert('Are you sure you want exit App?');" data-role="button" data-icon="flat-settings" data-theme="b" id="btnexitSetLoc" >Exit App</a></div>
	</div>
	
	</div>
	<div data-role="footer" data-theme="e">
		<h4>Location Log  &copy;Lavington Security Limited</h4>
	</div>
</div>


<script>
function getCameraImage() {
//document.addEventListener('deviceready', this.onDeviceReady.bind(this), false);

document.addEventListener("deviceready", onCameraDeviceReady, false);
function onCameraDeviceReady() {
   // alert(navigator.camera);
	//alert("getCameraImage capturing");
		if(navigator.camera) {
		//alert("At capturing level");
		navigator.camera.getPicture(onCaptureSuccess, onCaptureFail, {
			quality: 100, correctOrientation: true });
			//alert("getCameraImage capturing=>after");
			
			} else {
				alert("The camera seem to have issues.");
			}
}

    }
///capture image 
function onCaptureSuccess(imageData) {
		alert("Processing image");
      textocr.recText(0,imageData, onCameraSuccess, onCameraFail); // removed returnType (here 3) from version 2.0.0
      // for sourceType Use 0,1,2,3 or 4
      // for returnType Use 0,1,2 or 3 // 3 returns duplicates[see table]
      function onCameraSuccess(recognizedText) {
	  
	   //var element = document.getElementById('occupants');	   
	  //element.innerHTML=JSON.stringify(recognizedText);	  
      alert(JSON.stringify(recognizedText));
	//var str={"blocks":{"blocktext":["JAMHURI YA KENYA ge REPUBLIC OF KENYYA\nSERIAL NUMBER:01218467\nCHRISTOPHER KIPCHUMBA CHEPKEN","1D MUMBER 20648541","FULL NAMES","DATE OF BIRTH","01. 01. 1977","SEX\nMALE\nDISTRICT OF BIRTH\nKEIYO\nPLACE OF ISSUE\nHDM CBD\nDATE OF IsSUE\n13. 07. 2018","HOLDER's SIGN"],"blocklanguages":["en","en","en","en","und","und","en"],"blockpoints":[{"x1":135,"y1":1825,"x2":2723,"y2":1988,"x3":2692,"y3":2481,"x4":104,"y4":2318},{"x1":1673,"y1":2136,"x2":2432,"y2":2145,"x3":2431,"y3":2239,"x4":1672,"y4":2229},{"x1":151,"y1":2175,"x2":470,"y2":2188,"x3":469,"y3":2227,"x4":150,"y4":2213},{"x1":1102,"y1":2387,"x2":1466,"y2":2399,"x3":1465,"y3":2441,"x4":1101,"y4":2428},{"x1":1100,"y1":2456,"x2":1549,"y2":2473,"x3":1546,"y3":2551,"x4":1098,"y4":2533},{"x1":1073,"y1":2556,"x2":1545,"y2":2565,"x3":1531,"y3":3210,"x4":1059,"y4":3200},{"x1":1047,"y1":3323,"x2":1422,"y2":3332,"x3":1421,"y3":3370,"x4":1047,"y4":3360}],"blockframe":[{"x":104,"y":2481,"height":656,"width":2619},{"x":1672,"y":2239,"height":103,"width":760},{"x":150,"y":2227,"height":52,"width":320},{"x":1101,"y":2441,"height":54,"width":365},{"x":1098,"y":2551,"height":95,"width":451},{"x":1059,"y":3210,"height":654,"width":486},{"x":1047,"y":3370,"height":47,"width":375}]},"lines":{"linetext":["JAMHURI YA KENYA ge REPUBLIC OF KENYYA","SERIAL NUMBER:01218467","CHRISTOPHER KIPCHUMBA CHEPKEN","1D MUMBER 20648541","FULL NAMES","DATE OF BIRTH","01. 01. 1977","SEX","MALE","DISTRICT OF BIRTH","KEIYO","PLACE OF ISSUE","HDM CBD","DATE OF IsSUE","13. 07. 2018","HOLDER's SIGN"],"linelanguages":["en","en","en","en","en","en","und","und","und","und","und","und","und","und","und","en"],"linepoints":[{"x1":135,"y1":1825,"x2":2723,"y2":1988,"x3":2715,"y3":2105,"x4":127,"y4":1942},{"x1":140,"y1":2050,"x2":1162,"y2":2067,"x3":1160,"y3":2152,"x4":138,"y4":2135},{"x1":149,"y1":2233,"x2":1781,"y2":2309,"x3":1776,"y3":2396,"x4":144,"y4":2320},{"x1":1673,"y1":2136,"x2":2432,"y2":2145,"x3":2430,"y3":2238,"x4":1671,"y4":2229},{"x1":151,"y1":2175,"x2":470,"y2":2188,"x3":468,"y3":2226,"x4":149,"y4":2213},{"x1":1102,"y1":2387,"x2":1466,"y2":2399,"x3":1464,"y3":2440,"x4":1100,"y4":2428},{"x1":1100,"y1":2456,"x2":1549,"y2":2473,"x3":1546,"y3":2550,"x4":1097,"y4":2533},{"x1":1092,"y1":2556,"x2":1185,"y2":2558,"x3":1184,"y3":2595,"x4":1091,"y4":2593},{"x1":1084,"y1":2625,"x2":1262,"y2":2629,"x3":1260,"y3":2697,"x4":1082,"y4":2693},{"x1":1083,"y1":2725,"x2":1541,"y2":2740,"x3":1539,"y3":2777,"x4":1081,"y4":2762},{"x1":1075,"y1":2795,"x2":1304,"y2":2795,"x3":1304,"y3":2868,"x4":1075,"y4":2868},{"x1":1073,"y1":2894,"x2":1466,"y2":2907,"x3":1464,"y3":2946,"x4":1071,"y4":2933},{"x1":1068,"y1":2962,"x2":1363,"y2":2973,"x3":1360,"y3":3041,"x4":1065,"y4":3030},{"x1":1061,"y1":3064,"x2":1428,"y2":3071,"x3":1427,"y3":3111,"x4":1060,"y4":3104},{"x1":1061,"y1":3132,"x2":1513,"y2":3144,"x3":1511,"y3":3212,"x4":1059,"y4":3200},{"x1":1047,"y1":3323,"x2":1422,"y2":3332,"x3":1421,"y3":3369,"x4":1046,"y4":3360}],"lineframe":[{"x":127,"y":2105,"height":280,"width":2596},{"x":138,"y":2152,"height":102,"width":1024},{"x":144,"y":2396,"height":163,"width":1637},{"x":1671,"y":2238,"height":102,"width":761},{"x":149,"y":2226,"height":51,"width":321},{"x":1100,"y":2440,"height":53,"width":366},{"x":1097,"y":2550,"height":94,"width":452},{"x":1091,"y":2595,"height":39,"width":94},{"x":1082,"y":2697,"height":72,"width":180},{"x":1081,"y":2777,"height":52,"width":460},{"x":1075,"y":2868,"height":73,"width":229},{"x":1071,"y":2946,"height":52,"width":395},{"x":1065,"y":3041,"height":79,"width":298},{"x":1060,"y":3111,"height":47,"width":368},{"x":1059,"y":3212,"height":80,"width":454},{"x":1046,"y":3369,"height":46,"width":376}]},"words":{"wordtext":["JAMHURI","YA","KENYA","ge","REPUBLIC","OF","KENYYA","SERIAL","NUMBER:01218467","CHRISTOPHER","KIPCHUMBA","CHEPKEN","1D","MUMBER","20648541","FULL","NAMES","DATE","OF","BIRTH","01.","01.","1977","SEX","MALE","DISTRICT","OF","BIRTH","KEIYO","PLACE","OF","ISSUE","HDM","CBD","DATE","OF","IsSUE","13.","07.","2018","HOLDER's","SIGN"],"wordlanguages":["en","en","en","en","en","en","en","en","en","en","en","en","en","en","en","en","en","en","en","en","und","und","und","und","und","und","und","und","und","und","und","und","und","und","und","und","und","und","und","und","en","en"],"wordpoints":[{"x1":135,"y1":1828,"x2":657,"y2":1861,"x3":651,"y3":1950,"x4":129,"y4":1917},{"x1":687,"y1":1863,"x2":840,"y2":1872,"x3":834,"y3":1961,"x4":681,"y4":1952},{"x1":878,"y1":1875,"x2":1247,"y2":1898,"x3":1241,"y3":1987,"x4":872,"y4":1964},{"x1":1277,"y1":1942,"x2":1446,"y2":1952,"x3":1441,"y3":2024,"x4":1272,"y4":2014},{"x1":1680,"y1":1924,"x2":2157,"y2":1953,"x3":2151,"y3":2041,"x4":1674,"y4":2012},{"x1":2202,"y1":1956,"x2":2332,"y2":1964,"x3":2326,"y3":2049,"x4":2196,"y4":2041},{"x1":2376,"y1":1965,"x2":2724,"y2":1986,"x3":2718,"y3":2072,"x4":2370,"y4":2051},{"x1":140,"y1":2051,"x2":347,"y2":2054,"x3":345,"y3":2138,"x4":138,"y4":2135},{"x1":352,"y1":2054,"x2":1162,"y2":2068,"x3":1160,"y3":2153,"x4":350,"y4":2139},{"x1":149,"y1":2233,"x2":806,"y2":2263,"x3":801,"y3":2350,"x4":144,"y4":2320},{"x1":844,"y1":2267,"x2":1363,"y2":2291,"x3":1359,"y3":2374,"x4":840,"y4":2350},{"x1":1397,"y1":2294,"x2":1780,"y2":2311,"x3":1776,"y3":2394,"x4":1393,"y4":2377},{"x1":1673,"y1":2161,"x2":1717,"y2":2161,"x3":1716,"y3":2196,"x4":1672,"y4":2196},{"x1":1734,"y1":2165,"x2":1932,"y2":2167,"x3":1931,"y3":2208,"x4":1733,"y4":2206},{"x1":2007,"y1":2140,"x2":2432,"y2":2145,"x3":2430,"y3":2238,"x4":2005,"y4":2233},{"x1":151,"y1":2175,"x2":272,"y2":2180,"x3":270,"y3":2217,"x4":149,"y4":2212},{"x1":292,"y1":2181,"x2":470,"y2":2188,"x3":468,"y3":2226,"x4":290,"y4":2219},{"x1":1102,"y1":2389,"x2":1227,"y2":2393,"x3":1225,"y3":2432,"x4":1100,"y4":2428},{"x1":1247,"y1":2391,"x2":1310,"y2":2393,"x3":1308,"y3":2434,"x4":1245,"y4":2432},{"x1":1327,"y1":2399,"x2":1466,"y2":2403,"x3":1464,"y3":2439,"x4":1325,"y4":2435},{"x1":1100,"y1":2456,"x2":1206,"y2":2460,"x3":1203,"y3":2527,"x4":1097,"y4":2523},{"x1":1239,"y1":2463,"x2":1343,"y2":2467,"x3":1340,"y3":2534,"x4":1236,"y4":2530},{"x1":1380,"y1":2468,"x2":1549,"y2":2474,"x3":1546,"y3":2550,"x4":1377,"y4":2544},{"x1":1092,"y1":2556,"x2":1185,"y2":2558,"x3":1184,"y3":2595,"x4":1091,"y4":2593},{"x1":1084,"y1":2625,"x2":1262,"y2":2629,"x3":1260,"y3":2697,"x4":1082,"y4":2693},{"x1":1083,"y1":2725,"x2":1305,"y2":2732,"x3":1303,"y3":2768,"x4":1081,"y4":2761},{"x1":1322,"y1":2735,"x2":1383,"y2":2737,"x3":1381,"y3":2772,"x4":1320,"y4":2770},{"x1":1404,"y1":2738,"x2":1541,"y2":2742,"x3":1539,"y3":2777,"x4":1402,"y4":2773},{"x1":1075,"y1":2795,"x2":1304,"y2":2795,"x3":1304,"y3":2868,"x4":1075,"y4":2868},{"x1":1073,"y1":2894,"x2":1229,"y2":2899,"x3":1227,"y3":2938,"x4":1071,"y4":2933},{"x1":1247,"y1":2900,"x2":1310,"y2":2902,"x3":1308,"y3":2938,"x4":1245,"y4":2936},{"x1":1330,"y1":2902,"x2":1466,"y2":2906,"x3":1464,"y3":2943,"x4":1328,"y4":2939},{"x1":1068,"y1":2962,"x2":1205,"y2":2967,"x3":1202,"y3":3035,"x4":1065,"y4":3030},{"x1":1231,"y1":2968,"x2":1363,"y2":2973,"x3":1360,"y3":3037,"x4":1228,"y4":3032},{"x1":1061,"y1":3064,"x2":1189,"y2":3066,"x3":1188,"y3":3103,"x4":1060,"y4":3101},{"x1":1206,"y1":3069,"x2":1269,"y2":3070,"x3":1268,"y3":3106,"x4":1205,"y4":3105},{"x1":1290,"y1":3072,"x2":1428,"y2":3075,"x3":1427,"y3":3112,"x4":1289,"y4":3109},{"x1":1061,"y1":3132,"x2":1166,"y2":3134,"x3":1164,"y3":3202,"x4":1059,"y4":3200},{"x1":1199,"y1":3136,"x2":1305,"y2":3138,"x3":1303,"y3":3206,"x4":1197,"y4":3204},{"x1":1341,"y1":3141,"x2":1513,"y2":3145,"x3":1511,"y3":3212,"x4":1339,"y4":3208},{"x1":1047,"y1":3323,"x2":1289,"y2":3329,"x3":1288,"y3":3365,"x4":1046,"y4":3359},{"x1":1309,"y1":3330,"x2":1422,"y2":3332,"x3":1421,"y3":3369,"x4":1308,"y4":3367}],"wordframe":[{"x":129,"y":1950,"height":122,"width":528},{"x":681,"y":1961,"height":98,"width":159},{"x":872,"y":1987,"height":112,"width":375},{"x":1272,"y":2024,"height":82,"width":174},{"x":1674,"y":2041,"height":117,"width":483},{"x":2196,"y":2049,"height":93,"width":136},{"x":2370,"y":2072,"height":107,"width":354},{"x":138,"y":2138,"height":87,"width":209},{"x":350,"y":2153,"height":99,"width":812},{"x":144,"y":2350,"height":117,"width":662},{"x":840,"y":2374,"height":107,"width":523},{"x":1393,"y":2394,"height":100,"width":387},{"x":1672,"y":2196,"height":35,"width":45},{"x":1733,"y":2208,"height":43,"width":199},{"x":2005,"y":2238,"height":98,"width":427},{"x":149,"y":2217,"height":42,"width":123},{"x":290,"y":2226,"height":45,"width":180},{"x":1100,"y":2432,"height":43,"width":127},{"x":1245,"y":2434,"height":43,"width":65},{"x":1325,"y":2439,"height":40,"width":141},{"x":1097,"y":2527,"height":71,"width":109},{"x":1236,"y":2534,"height":71,"width":107},{"x":1377,"y":2550,"height":82,"width":172},{"x":1091,"y":2595,"height":39,"width":94},{"x":1082,"y":2697,"height":72,"width":180},{"x":1081,"y":2768,"height":43,"width":224},{"x":1320,"y":2772,"height":37,"width":63},{"x":1402,"y":2777,"height":39,"width":139},{"x":1075,"y":2868,"height":73,"width":229},{"x":1071,"y":2938,"height":44,"width":158},{"x":1245,"y":2938,"height":38,"width":65},{"x":1328,"y":2943,"height":41,"width":138},{"x":1065,"y":3035,"height":73,"width":140},{"x":1228,"y":3037,"height":69,"width":135},{"x":1060,"y":3103,"height":39,"width":129},{"x":1205,"y":3106,"height":37,"width":64},{"x":1289,"y":3112,"height":40,"width":139},{"x":1059,"y":3202,"height":70,"width":107},{"x":1197,"y":3206,"height":70,"width":108},{"x":1339,"y":3212,"height":71,"width":174},{"x":1046,"y":3365,"height":42,"width":243},{"x":1308,"y":3369,"height":39,"width":114}]},"foundText":true};
	var str=JSON.stringify(recognizedText);
	alert(str);
	var names =recognizedText.blocks.blocktext[0];
	//var names = str.blocks.blocktext;
	//alert("here"+ names +" "+namess);
	alert("here1   "+ names );
	//var n = (x.match(/\n/g)||[]).length;
	var name =names.split(/\r?\n/);
	var splitted = names.split("\n");   
	alert("here2  "+ splitted);
	var namearr= splitted.split(",");
	alert("namearr  "+ namearr);
	name=namearr[2];
	alert("here2  "+ name);
	var idnum=recognizedText.blocks.blocktext[1];
	var idarr= idnum.split(" ");
	idnum=idarr[2];
alert("here3  "+ idnum);	
var nameelement = document.getElementById('visitornames');	   
nameelement.innerHTML=name;
	
var idnumelement = document.getElementById('id_number');	   
idnumelement.innerHTML=idnum;
	//x +=" "+str.blocks.blocktext[2];
	//x +=" "+str.blocks.blocktext[3];
		//x +=" "+str.blocks.blocktext[4];
	alert ("ID=" +idnum+" Names= "+name);         
            //Use above two lines to show recognizedText in html
            
      }
	  
      function onCameraFail(message) {
            alert('Failed because: ' + message);
      }
}
 function onCaptureFail(message) {
            alert('Capture Failed because: ' + message);
      }


var lat=0;var lng=0;

function getLocation() {
		if(navigator.geolocation) {
		navigator.geolocation.getCurrentPosition(
			geoSuccess, geoError, {maximumAge:0, timeout:30000, enableHighAccuracy: true}
			);
			} else {
				alert("Geolocation is not supported by this browser.");
			}
    }
function geoSuccess(position) {
     lat = position.coords.latitude;
     lng = position.coords.longitude;  
	//var userLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
       //  returnAddress(userLatLng);
		/*
			1. sent to server for interpretation 
			2. return back for display
			3. then log it if the user says yes
		*/
		//alert(lat+" , "+lng);		
		getAddress(lat,lng);
		//createMap(lat,lng);
		
	}
	
 function geoError(error) {
	if (error.code == error.TIMEOUT){
        // Attempt to get GPS loc timed out after 5 seconds, 
        // try low accuracy location
		alert("Attempting to get low accuracy location");
        navigator.geolocation.getCurrentPosition(
               geoSuccess, 
               errorCallback_lowAccuracy,
               {maximumAge:0, timeout:30000, enableHighAccuracy: false});
        return;    
}
 var msg = "<p>Can't get your location (high accuracy attempt). Error = ";
    if (error.code == 1)
        msg += "PERMISSION_DENIED";
    else if (error.code == 2)
        msg += "POSITION_UNAVAILABLE";
    msg += ", msg = "+error.message;
   alert(msg);
}
function errorCallback_lowAccuracy(error) {
    var msg = "<p>Can't get your location (low accuracy attempt). Error = ";
    if (error.code == 1)
        msg += "PERMISSION_DENIED";
    else if (error.code == 2)
        msg += "POSITION_UNAVAILABLE";
    else if (error.code == 3)
        msg += "TIMEOUT";
    msg += ", msg = "+error.message;    
    alert(msg);
}
function getAddress(lat,lng){
var geocoder = L.mapquest.geocoding();
geocoder.reverse([lat,lng], geocodingCallback);
}

function geocodingCallback(error, result) {
  //alert(result);
	  alert(result.results[0].locations[0].street);
      var location = result.results[0].locations[0];
      var street = location.street;
      var city = location.adminArea5;
	 var acAddress=street +","+city;
	 alert(street +", "+city);
	 if(saveORlog==0){
		   document.getElementById("address").innerHTML=street +", "+city;
			//var telNo=$("#loc_telNo").val();
			var logType=$("#logType").val();			
			var telNo= sessionStorage.getItem("telNo");
			telNo=eval("("+telNo+")");
	  ////////////			
		    getAddressFromServer(telNo,simSerial1,simSerial2,lat,lng,fingerOrPin,acAddress,logType);			
		   }
		   
		   else if(saveORlog==1){
		   document.getElementById("saveAddress").innerHTML=street +", "+city;
		  // var telNoSave=$("#telNoSave").val();
		   var telNoSave= sessionStorage.getItem("telNo");
			telNoSave=eval("("+telNo+")");
		   var client=$("#clientName").val();
		   var location=$("#locationName").val();
		   var point=$("#pointName").val();
		   
		   //alert("Tel: "+ telNoSave);
		   saveNewPoints(lat,lng,telNoSave,simSerial1,simSerial2,fingerOrPin,client,location,point,acAddress);		   
		   }
		   			
			//}
          else
             displayAlert("Unable to retrieve your address") ;
}
function createMap(lat,lng){
 var map = L.mapquest.map('map', {
          center: [lat,lng],
          layers: L.mapquest.tileLayer('map'),
          zoom: 14
        });

        L.mapquest.control().addTo(map);
        L.mapquest.geocodingControl().addTo(map);
}

function createStorage(){
var today = new Date();
var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
if (localStorage.getItem('logCounter') === null) {
		localStorage.setItem("logCounter", 0);
		localStorage.setItem("todaysDate", date);			
		}else{		
    var inDate=localStorage.getItem("todaysDate");		
	if(inDate===date ){// if it is today, do nothing
	}else{//
	localStorage.setItem("todaysDate", date);
	localStorage.setItem("logCounter", 0);
 }

		
	}
}
function increaseLogCount(){
   var counter= parseInt(localStorage.getItem("logCounter"));
	counter=counter+1;
  localStorage.setItem("logCounter", counter);
}
	
function checkLogingLimit(){
var flag=false;
var today = new Date();
var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
var inDate=localStorage.getItem("todaysDate");

if(localStorage.getItem("logCounter")>=10 && inDate===date ){
flag= false; 
}
 else{
 flag= true;
 }
 return flag;
}
	var lat;
    var lng;
	function getAddressFromServer(telNo,simSerial1,simSerial2,latitude,longitude,fingerOrPin,address,logType)
	{
		$(document).ready(function(){		
		//var device=getDeviceDetails(); // commented on 09-08-2019
		var device="xxxxxx_yyyyyy";	
		 //alert('simSerialNumber=   ' + simSerial1);
		// alert('simSerialNumber2=   ' + simSerial2);
		var url=serverURL +"saveLogDetails.php";
		//alert("Focused now");
		$.ajax(
		{	
        // Post select to url.
        type : 'post',
        url : url,
        dataType : 'text', // expected returned data format.
        data : {
		latitude:latitude,
		longitude:longitude,
		device:device,
		simSerial1:simSerial1,
		simSerial2:simSerial2,
		telNo:telNo,
		fingerOrPin:fingerOrPin,
		address:address,
		logType:logType
        },
        success : function(data){		
		displayAlert("You are done logging this location");
		//findPhone();
		},
	error:function(data,e) {
    if (data.status==0) {
        alert('You are offline!!\n Please Check Your Network.');
    } else if(data.status==404) {
        alert('Requested URL not found.');
    } else if(data.status==500) {
        alert('Internel Server Error.');
    } else if(e=='parsererror') {
        alert('Error.\nParsing JSON Request failed.');
    } else if(e=='timeout'){
        alert('Request Time out.');
    } else {
        alert('Unknow Error.\n'+data.responseText);
		}
	},
        complete : function(data){		
			document.getElementById("latitude").innerHTML=latitude;
			document.getElementById("longitude").innerHTML=longitude;
			}
		});
		});
	}	
	function saveNewPoints(latitude,longitude,telNo,simSerial1,simSerial2,fingerOrPin,client,location,point,address){
		$(document).ready(function(){		
		//var device=getDeviceDetails(); //commented on 09-08-2019
		var device="xxxxxx_yyyyyy";			 
		var url=serverURL +"saveLocationDetails.php";
		//alert("Focused now");
		$.ajax(
		{	
        // Post select to url.
        type : 'post',
        url : url,
        dataType : 'text', // expected returned data format.
        data : {
		latitude:latitude,
		longitude:longitude,
		telNo:telNo,
		simSerial1:simSerial1,
		simSerial2:simSerial2,
		device:device,
		client:client,
		location:location,
		point:point,
		fingerOrPin:fingerOrPin,
		address:address
        },
        success : function(data){		
		displayAlert("You are done saving this point");
		//findPhone();
		},
	error:function(data,e) {
    if (data.status==0) {
        alert('You are offline!!\n Please Check Your Network.');
    } else if(data.status==404) {
        alert('Requested URL not found.');
    } else if(data.status==500) {
        alert('Internel Server Error.');
    } else if(e=='parsererror') {
        alert('Error.\nParsing JSON Request failed.');
    } else if(e=='timeout'){
        alert('Request Time out.');
    } else {
        alert('Unknow Error.\n'+data.responseText);
		}
	},
        complete : function(data){		
			document.getElementById("latSave").innerHTML=latitude;
			document.getElementById("longSave").innerHTML=longitude;
			}
    });
	});

}
	//================================
	function findPhone(){
	 document.addEventListener('deviceready', this.onDeviceReady.bind(this), false);
	 //hasReadPermission();
	}
	function onDeviceReady(){	
	hasReadPermission();
	}
	function HasPerminionSuccessCallback(result) {
		if (result) {
			//window.plugins.sim.getSimInfo(simInfosuccessCallback, errorCallback);
			window.plugins.sim.getSimInfo(simInfosuccessCallback, errorCallback);
		} else {
			requestReadPermission();
		}
	}
	function errorCallback(error) {
		var elementSimInfo = document.getElementById('ErrorInfo');
		elementSimInfo.innerHTML = error;
	}
	function requestSuccessCallback(result) {
    if (result) {
        hasReadPermission();
    }
	}
// Android only: check permission
	function hasReadPermission() {
		window.plugins.sim.hasReadPermission(HasPerminionSuccessCallback, errorCallback);
		//window.plugins.camera.hasReadPermission(HasPerminionSuccessCallback, errorCallback);
	}
// Android only: request permission
	function requestReadPermission() {
	//window.plugins.camera.requestReadPermission(requestSuccessCallback, errorCallback);
	window.plugins.sim.requestReadPermission(requestSuccessCallback, errorCallback);
	}
	function simInfosuccessCallback(result) {
    if (result !== undefined && result != null && result != '') {				  
				/*alert('carrierName=  ' + result.carrierName);                 
                alert('phoneType =   ' + result.phoneType);                
                alert('phoneNumber=  ' + result.phoneNumber);
				alert('simSerialNumber=   ' + result.simSerialNumber);
                alert('subscriberId=  ' + result.subscriberId );
				alert("No. of Cards=  "+ result.cards.length + "Phone Count= "+ result.phoneCount);
				*/
				simSerial1=result.simSerialNumber;				
     }
	 if (result.cards.length > 0 && result.phoneCount > 1) {
		  /*alert('displayName[1]=  ' + result.cards[0].displayName);
		  alert('displayName[2]=  ' + result.cards[1].displayName);
		  alert('simSlotIndex[1]' + result.cards[0].simSlotIndex );
		  alert('simSlotIndex[2]' + result.cards[1].simSlotIndex ); 
		  alert('phoneNumber[1]=  ' + result.cards[0].phoneNumber);
		  alert('phoneNumber[2]=  ' + result.cards[1].phoneNumber);
		  alert('simSerialNumber[1]=   ' + result.cards[0].simSerialNumber);
		  alert('simSerialNumber[2]=   ' + result.cards[1].simSerialNumber);*/
		  //alert('subscriberId[1]=  ' + result.cards[0].subscriberId );	
		  //alert('subscriberId[2]=  ' + result.cards[1].subscriberId );	
		  simSerial1=result.cards[0].simSerialNumber;
	       simSerial2=result.cards[1].simSerialNumber;
		  
	  }
	}
	//==============================
	function getDeviceDetails(){
	  return  device.model +"_"+ device.uuid; 
			  
	}
	function readFingerprint(){			
		FingerprintAuth.isAvailable(function (result) {
			//console.log("FingerprintAuth available: " + JSON.stringify(result));			
			if (result.isAvailable == true && result.hasEnrolledFingerprints == true) {
         var encryptConfig = {
            clientId: "myAppName",
            username: "currentUser",
            password: "currentUserPassword",
            maxAttempts: 5,
            locale: "en_US",
            dialogTitle: "Scan Finger",
            dialogMessage: "Kindly put your registered finger on the device",
            dialogHint: "Ensure that you see the Successfully logged message "
        }; // See config object for required parameters
        // Set config and success callback
        FingerprintAuth.encrypt(encryptConfig, function(_fingerResult){
            //console.log("successCallback(): " + JSON.stringify(_fingerResult));
            if (_fingerResult.withFingerprint) {
                //console.log("Successfully Successfully logged location.");				
				//console.log("Encrypted credentials: " + result.token);		
			fingerOrPin=0;
			getLocation();//Display the current possition            
			} else if (_fingerResult.withBackup) {
				fingerOrPin=1;
				getLocation();
			console.log("Authenticated with backup password");
		   // alert("Authenticated with backup password");
            }
        // Error callback
        }, function(err){
                if (err === "Cancelled") {
                console.log("FingerprintAuth Dialog Cancelled!");
			 displayAlert("FingerprintAuth Dialog Cancelled!");			
            } else {
             console.log("FingerprintAuth Error: " + err);
		     displayAlert("FingerprintAuth Error: " + err);
            }
        });
    }
	else {
	displayAlert("Fingerprint availability error: Available=  "+ result.isAvailable + "  Enrolled=  " +result.hasEnrolledFingerprints + "  isHardwareDetected=  "+ result.isHardwareDetected);

 }
		/**
		* @return {
		*      isAvailable:boolean,
		*      isHardwareDetected:boolean,
		*      hasEnrolledFingerprints:boolean
		*   }
		*/
	}, function (message) {
		console.log("isAvailableError(): " + message);
	  alert("isAvailableError(): " + message);
		});
	}
function logSavePayAlert(msg) {
		dialog.style.cssText = "color: red; background-color: black; border: 1px solid red"; 	
		document.getElementById("alertclass1").innerHTML=msg;
			$( "#dialog" ).dialog({
			autoOpen: true,
			modal: true,
			width: 300,
			height: 200,
			buttons:{
			Yes: function() {
			$(this).dialog("close");			
			//1. Call the fingerprint function and then
			savePayrollChanges();
			//Call log location function
    },
		No: function() {
        $(this).dialog("close");
    }
		},
		show: {
		effect: "slide",
		duration: 200
		},
		hide: {
		effect: "fade",
		duration: 200
		}	
		});		
	$( ".selector" ).dialog({
		closeOnEscape: false
		});
  }	
	function logAlert(msg) {
		dialog.style.cssText = "color: red; background-color: black; border: 1px solid red"; 	
		document.getElementById("alertclass1").innerHTML=msg;
			$( "#dialog" ).dialog({
			autoOpen: true,
			modal: true,
			width: 300,
			height: 200,
			buttons:{
			Yes: function() {
			$(this).dialog("close");			
			//1. Call the fingerprint function and then
			readFingerprint(); //commented on 11-08-2019
			increaseLogCount(); 
			//Call log location function
    },
		No: function() {
        $(this).dialog("close");
    }
		},
		show: {
		effect: "slide",
		duration: 200
		},
		hide: {
		effect: "fade",
		duration: 200
		}	
		});		
	$( ".selector" ).dialog({
		closeOnEscape: false
		});
  }
  	function exitAlert(msg) {
		dialog.style.cssText = "color: red; background-color: black; border: 1px solid red"; 	
		document.getElementById("alertclass1").innerHTML=msg;
	  $( "#dialog" ).dialog({
		autoOpen: true,
		modal: true,
		width: 300,
		height: 200,
		buttons:{
		
		Yes: function() {
			$(this).dialog("close");		
			endSession();
			navigator.app.exitApp();        
		},
			No: function() {
			$(this).dialog("close");			
			}
		},
		show: {
		effect: "slide",
		duration: 200
		},
		hide: {
		effect: "fade",
		duration: 200
		}	
		});		
	$( ".selector" ).dialog({
		closeOnEscape: false
		});
  }   
	function displayAlert(response) {
	dialog.style.cssText = "color: red; background-color: black; border: 1px solid red"; 	
	document.getElementById("alertclass1").innerHTML=response;
	  $( "#dialog" ).dialog({
		autoOpen: true,
		modal: true,
		width: 300,
		height: 200,
		buttons: {
		Ok: function() {
		$( this ).dialog( "close" );
		}
		},
		show: {
		effect: "slide",
		duration: 200
		},
		hide: {
		effect: "fade",
		duration: 200
		}	
		});		
	$( ".selector" ).dialog({
		closeOnEscape: false
		});
  } 
  function savePayrollChanges(){
	  console.log("Saving");
	  var pfIDNo=$("#pfIDNo").val();
	  var empNames=$("#empNames").val();
	  var assignment=$("#assignment").val();
	  var dateDeployedLeft= $("#dateDeployedLeft").val();
	  //var salaryMonth= $("#salaryMonth").val();	 
		var dateString = new Date();
		var dd = dateString.getDate();
		var mm = dateString.getMonth() + 1; // getMonth() is zero-based
		var yy = dateString.getFullYear();
		var salaryMonth= yy+"-"+mm+"-"+dd;
		//alert(yy);
	  var daysWorked= $("#daysWorked").val();
	  var changeType= $("#changeType").val();
	  var changeTypeDesc=$('#changeType option:selected').text();
	  //alert(changeType);
	  var telNo= sessionStorage.getItem("telNo");
	  telNo=eval("("+telNo+")");
	  console.log("PF is  "+pfIDNo );
	var url=serverURL +"savePayrollChanges.php";
		//alert("Focused now");
		$.ajax(
		{	
        // Post select to url.
        type : 'post',
        url : url,
        dataType : 'text', // expected returned data format.
        data : {
		pfIDNo:pfIDNo,
		empNames:empNames,
		assignment:assignment,
		dateDeployedLeft:dateDeployedLeft,
		salaryMonth:salaryMonth,
		daysWorked:daysWorked,
		changeType:changeType,
		changeTypeDesc:changeTypeDesc,
		telNo:telNo		
        },
        success : function(data){		
		//displayAlert("You are done saving this change");
		displayAlert(eval("("+data+")"));
		document.getElementById("changeType").selectedIndex = 1; 
		$('#changeType').prop('selectedindex',1);
		$('#changeType').trigger("chosen:updated");		
		$('#changeType option').prop('selected', function() {
        return this.defaultSelected;
			});
        //$('#changeType').find('option:first').attr('selected', 'selected');
		//$("#changeType").val("");
		//$('#changeType').get(0).selectedIndex = 0;
		//$('#changeType option:selected').text("");	
		//findPhone();
		},
	error:function(data,e) {
    if (data.status==0) {
        alert('You are offline!!\n Please Check Your Network.');
    } else if(data.status==404) {
        alert('Requested URL not found.');
    } else if(data.status==500) {
        alert('Internel Server Error.');
    } else if(e=='parsererror') {
        alert('Error.\nParsing JSON Request failed.');
    } else if(e=='timeout'){
        alert('Request Time out.');
    } else {
        alert('Unknow Error.\n'+data.responseText);
		}
	},
        complete : function(data){	
				
			//document.getElementById("latitude").innerHTML=latitude;
			//document.getElementById("longitude").innerHTML=longitude;
			}
		});
  }
  function storeSession(usn,names,telNo,supID){	
	// a function to store the username session name and display who is logged in	 
	sessionStorage.setItem('usn',JSON.stringify(usn));	
	sessionStorage.setItem('names',JSON.stringify(names));
	sessionStorage.setItem('telNo',JSON.stringify(telNo));
	//sessionStorage.setItem('supID',JSON.stringify(supID));	
		globalusn=usn;
		globalNames=names;
		globalTelNo=telNo;
		}
	
	function endSession(){	
	// a function to store the username session name and display who is logged in	 
	sessionStorage.setItem('usn',JSON.stringify(''));	
	sessionStorage.setItem('names',JSON.stringify(''));
	sessionStorage.setItem('telNo',JSON.stringify(''));	
	//sessionStorage.setItem('supID',JSON.stringify(''));	
		globalusn='';
		globalNames='';
		globalTelNo='';		
		}
		
	function checkLengthLogin(el,screen,button) {
		$(button).attr("disabled", true);		
		if (el.value.length<4 || el.value.length>12){
			$(button).attr("disabled", true);
			$(el).focus();			
			el.style.cssText = "color: red; border: 1px solid red"; 		
		document.getElementById(screen).innerHTML="The length must be between 4 and 12 characters; The button is disabled";					

	 }else {
	 $(button).attr("disabled", false);
	// el.classList.remove('invalid');
	 el.style.color = null;
	 el.style.border = null;
     document.getElementById(screen).innerHTML=  "";		
	 }
	}
	function readSession(){ //checking if the session has a login value
		var s=sessionStorage.getItem("usn");
		return s;	 
	}


	
    function checkonPageshow(){// on click of back and forward button, we check if the login session is still active
	console.log("Checking session ");	
	try{
	if (sessionStorage.getItem('usn')){		
	var originalValue = JSON.parse(sessionStorage.getItem('usn')); //outputs null
		if (originalValue == null || originalValue==''){			
			var urld2=baseURL +"index.html#mfloginPage";
			var urld3=baseURL +"index.html#changePassword";				
			if(window.location.href==urld2)
			{//do nothing
			
			}
			if(window.location.href==urld3)
			{//do nothing
			//window.location.replace(baseURL +"index.html#changePassword");
			window.location.replace("index.html#changePassword");
			console.log("Password replace 1");
			}
			else{
				//window.location.replace(baseURL +"index.html#mfloginPage");
				window.location.replace("index.html#mfloginPage");
				//location.reload(true);	
			} 
		}
		else{ //Stay on where you are  
		//window.location.href = baseURL +"index.html";
		}
	}else{
			var urld2=baseURL +"index.html#mfloginPage";
			var urld3=baseURL +"index.html#changePassword";				
			 if(window.location.href==urld2){
			 //do nothing
			 //window.location.replace(baseURL +"index.html#changePassword");
			}
			if(window.location.href==urld3)
			{//do nothing
			window.location.replace("index.html#changePassword");
			console.log("Password replace 2");
			}
			else{			
				window.location.replace("index.html#mfloginPage");
				//location.reload(true);
				} 
		
	}
	}
	catch(e){}
	}
</script>
</body>
</html>

